{% load humanize %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Individual Project Information - {{ project.name }}</title>
    <style>
        @page { size: A4; margin: 12mm 12mm 12mm 12mm; }
        body {
            font-family: "Times New Roman", serif;
            font-size: 11pt;
            color: #000;
        }
        .spacer-8 { height: 8px; }
        .spacer-12 { height: 12px; }
        table { width: 100%; border-collapse: collapse; }
        .band td {
            background: #2f5f1f;
            color: #fff;
            font-weight: bold;
            text-align: center;
            border: 1px solid #2f5f1f;
            padding: 2px 6px;
        }
        .title td {
            background: #3d3836;
            color: #fff;
            font-weight: bold;
            text-align: center;
            border: 1px solid #3d3836;
            font-size: 16px;
            padding: 4px 6px;
        }
        .asof { text-align: center; font-weight: bold; margin: 8px 0 10px 0; font-size: 11pt; }
        .meta td {
            border: 1px solid #777;
            padding: 3px 6px;
        }
        .meta .label { width: 32%; font-weight: bold; }
        .lines td {
            border-bottom: 1px solid #999;
            padding: 3px 4px;
            vertical-align: top;
        }
        .lines .label { width: 46%; font-weight: bold; }
        .remark td {
            background: #3d3836;
            color: #fff;
            font-weight: bold;
            text-align: center;
            border: 1px solid #3d3836;
            padding: 4px 6px;
        }
        .sig td {
            width: 50%;
            vertical-align: top;
            padding-top: 12px;
        }
        .sig-line {
            border-bottom: 1px solid #000;
            margin: 14px 18px 4px 0;
            height: 12px;
        }
        .page { text-align: center; font-size: 8pt; margin-top: 14px; }
    </style>
</head>
<body>
    <table class="band">
        <tr>
            <td>CITY OF TAGUM</td>
            <td>CEO - CONSTRUCTION DIVISION</td>
        </tr>
    </table>

    <table class="title">
        <tr><td>INDIVIDUAL PROJECT INFORMATION</td></tr>
    </table>

    <div class="asof">
        AS OF:
        {% if project.start_date and project.end_date %}
            {{ project.start_date|date:"F d, Y" }} TO {{ project.end_date|date:"F d, Y" }}
        {% else %}
            {{ generated_at|date:"F d, Y" }}
        {% endif %}
    </div>

    <table class="meta">
        <tr><td class="label">PROJECT NAME:</td><td>{{ project.name|default:"N/A" }}</td></tr>
        <tr><td class="label">LOCATION:</td><td>{{ project.barangay|default:"N/A" }}</td></tr>
        <tr><td class="label">REFERENCE NUMBER:</td><td>{{ project.prn|default:"N/A" }}</td></tr>
    </table>

    <div class="spacer-8"></div>

    <table class="lines">
        <tr><td class="label">Project Cost</td><td>: PHP {{ budget|floatformat:2|default:"0.00"|intcomma }}</td></tr>
        <tr><td class="label">Source of fund</td><td>: {{ project.source_of_funds|default:"N/A" }}</td></tr>
        <tr><td class="label">Date Started</td><td>: {{ project.start_date|date:"F d, Y"|default:"N/A" }}</td></tr>
        <tr><td class="label">Target Date of Completion</td><td>: {{ project.end_date|date:"F d, Y"|default:"N/A" }}</td></tr>
        <tr><td class="label">Project Duration</td><td>: {% if total_days %}{{ total_days }} WORKING DAYS{% else %}N/A{% endif %}</td></tr>
        <tr><td class="label">No. of Time Extension (if any)</td><td>: N/A</td></tr>
        <tr><td class="label">Revised target date of completion</td><td>: N/A</td></tr>
        <tr><td class="label">No. of Days Elapsed to date</td><td>: {{ days_elapsed|default:"N/A" }}</td></tr>
        <tr><td class="label">Remaining No. of Days</td><td>: {{ days_remaining|default:"N/A" }}</td></tr>
        <tr><td class="label">Project Description</td><td>: {{ project.description|default:"N/A" }}</td></tr>
        <tr><td class="label">Mode of Implementation</td><td>: BY ADMINISTRATION</td></tr>
        <tr><td class="label">Scheduled Project Accomplishment</td><td>: {% if expected_progress is not None %}{{ expected_progress|floatformat:2 }}%{% else %}N/A{% endif %}</td></tr>
        <tr><td class="label">Actual Project Accomplishment</td><td>: {{ total_progress|default:0 }}%</td></tr>
        <tr><td class="label">Slippage</td><td>: {% if progress_variance is not None %}{{ progress_variance|floatformat:2 }}%{% else %}N/A{% endif %}</td></tr>
    </table>

    <div class="spacer-12"></div>

    <table class="remark">
        <tr>
            <td>REMARKS</td>
            <td>
                {% if project.status == 'completed' %}PROJECT COMPLETED
                {% elif project.status == 'delayed' %}PROJECT DELAYED
                {% elif project.status == 'planned' or project.status == 'pending' %}PROJECT PLANNED
                {% else %}PROJECT ON GOING
                {% endif %}
            </td>
        </tr>
    </table>

    <table class="sig">
        <tr>
            <td>
                <div>Prepared by:</div>
                <div class="sig-line"></div>
                <div><strong>{% if assigned_engineers %}{{ assigned_engineers.0.get_full_name|default:assigned_engineers.0.username }}{% else %}{{ generated_by|default:"N/A" }}{% endif %}</strong></div>
                <div>Project In-Charge</div>
            </td>
            <td>
                <div>Concurred by:</div>
                <div class="sig-line"></div>
                <div><strong>{{ generated_by|default:"Head Engineer" }}</strong></div>
                <div>Head Engineer</div>
            </td>
        </tr>
    </table>

    <div class="page">Page 1 of 1</div>
</body>
</html>
